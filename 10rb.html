<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Link Shopee Pagination</title>
<style>
  body { font-family: Arial, sans-serif; margin: 15px; max-width: 700px; margin-left:auto; margin-right:auto; }
  h2,h3 { font-size: 1.2rem; margin-bottom: 8px; }
  textarea { width:100%; height:150px; box-sizing:border-box; font-size:1rem; padding:8px; border-radius:6px; border:1px solid #ccc; }
  #output, #uniqueOutput { display:none; margin-top:10px; }
  #output a, #uniqueOutput a { display:block; margin-bottom:6px; color:#0066cc; text-decoration:none; word-wrap:break-word; }
  #output a:hover, #uniqueOutput a:hover { text-decoration:underline; }
  .pagination { margin-top:15px; text-align:center; display:flex; flex-wrap:wrap; gap:6px; justify-content:center; }
  .page-btn { padding:10px 14px; cursor:pointer; border:1px solid #ccc; border-radius:6px; background-color:white; font-size:1rem; min-width:40px; }
  .page-btn:hover { background-color:#ffd42a; color:#b36b00; }
  .active { font-weight:bold; background-color:#ffd42a; color:#b36b00; border-color:#b36b00; }
  #copyBtn, #toggleUniqueBtn, #copyUniqueBtn { margin-top:12px; padding:12px; font-size:1rem; cursor:pointer; border:none; background-color:#ffd42a; color:#b36b00; border-radius:6px; width:100%; }
  #copyBtn:hover, #toggleUniqueBtn:hover, #copyUniqueBtn:hover { background-color:#e6c72b; }
  .input-buttons { display:flex; gap:8px; margin-top:6px; flex-wrap:wrap; }
  .input-buttons button { flex:1; padding:10px; font-size:0.95rem; cursor:pointer; border:1px solid #ccc; border-radius:6px; background:#f5f5f5; }
  .input-buttons button:hover { background:#eee; }
  #stats { margin:15px 0; font-weight:bold; font-size:1rem; white-space:pre-line; }
  .sponsor { background-color:#fffae6; border:1px solid #ffd42a; padding:12px; margin:15px 0; font-weight:bold; text-align:center; color:#b36b00; border-radius:6px; box-shadow:0 0 5px rgba(255,212,42,0.5); font-size:1rem; }
  @media (max-width:480px){
    h2,h3{ font-size:1rem; }
    textarea{ height:120px; font-size:0.9rem; }
    #output, #uniqueOutput{ font-size:0.85rem; }
    .page-btn{ padding:8px 12px; font-size:0.9rem; }
    #copyBtn, #toggleUniqueBtn, #copyUniqueBtn{ font-size:0.95rem; }
    .input-buttons{ flex-direction:column; }
    .input-buttons button{ flex:unset; width:100%; }
  }
</style>
</head>
<body>

<h2>Masukkan Link Shopee</h2>
<textarea id="inputLinks" placeholder="Masukkan ribuan link Shopee, satu per baris..."></textarea>
<div class="input-buttons">
  <button id="ambilLinksBtn">Ambil dari data.txt</button>
  <button id="clearInputLinksBtn">Clear Input Links</button>
  <button id="copyInputLinksBtn">Copy Input Links</button>
</div>

<div class="sponsor">
  Disponsori oleh <strong>Kios Tembakau MadGazan</strong>
</div>

<h3>Masukkan ID Toko yang Dikecualikan (satu per baris)</h3>
<textarea id="excludedShops" placeholder="Contoh: 123456789&#10;987654321"></textarea>
<div class="input-buttons">
  <button id="ambilTokoBtn">Ambil dari data_toko.txt</button>
  <button id="clearInputTokoBtn">Clear Input Toko</button>
  <button id="copyInputTokoBtn">Copy Input Toko</button>
</div>

<div id="stats"></div>

<h3>Output (maks 100 per halaman)</h3>
<div id="output"></div>
<button id="copyBtn" onclick="copyToClipboard()">Copy Link di Halaman Ini</button>

<div class="pagination" id="pagination"></div>

<!-- Output unik per toko -->
<div style="margin-top:15px;">
  <button id="toggleUniqueBtn" onclick="toggleUniqueOutput()">Tampilkan/Sembunyikan Link Unik per Toko</button>
  <button id="copyUniqueBtn" onclick="copyUniqueOutput()">Copy Link Unik per Toko</button>
  <div id="uniqueOutput"></div>
</div>

<script>
let allLinks=[], currentPage=1, maxPerPage=100;
const inputLinksEl=document.getElementById('inputLinks');
const excludedShopsEl=document.getElementById('excludedShops');
const pageKey=location.pathname.split('/').pop().replace(/\.[^/.]+$/,'');

window.onload=()=>{ 
  if(localStorage.getItem(`${pageKey}_inputLinks`)) inputLinksEl.value=localStorage.getItem(`${pageKey}_inputLinks`);
  if(localStorage.getItem(`${pageKey}_excludedShops`)) excludedShopsEl.value=localStorage.getItem(`${pageKey}_excludedShops`);
  processLinks();
}

// Ambil data.txt
document.getElementById('ambilLinksBtn').addEventListener('click',async ()=>{
  try{
    const res=await fetch('data.txt?t='+Date.now(),{cache:'no-store'});
    if(!res.ok) throw new Error('HTTP '+res.status);
    const text=await res.text();
    const rows=text.split(/\r?\n/).map(r=>r.trim()).filter(Boolean);
    inputLinksEl.value=rows.join("\n");
    localStorage.setItem(`${pageKey}_inputLinks`,inputLinksEl.value);
    processLinks();
  }catch(e){alert("Gagal mengambil data.txt: "+e.message);}
});

// Ambil data_toko.txt
document.getElementById('ambilTokoBtn').addEventListener('click',async ()=>{
  try{
    const res=await fetch('data_toko.txt?t='+Date.now(),{cache:'no-store'});
    if(!res.ok) throw new Error('HTTP '+res.status);
    const text=await res.text();
    const rows=text.split(/\r?\n/).map(r=>r.trim()).filter(Boolean);
    excludedShopsEl.value=rows.join("\n");
    localStorage.setItem(`${pageKey}_excludedShops`,excludedShopsEl.value);
    processLinks();
  }catch(e){alert("Gagal mengambil data_toko.txt: "+e.message);}
});

// Clear/copy links
document.getElementById('clearInputLinksBtn').addEventListener('click',()=>{ inputLinksEl.value=''; localStorage.removeItem(`${pageKey}_inputLinks`); processLinks(); });
document.getElementById('copyInputLinksBtn').addEventListener('click',()=>{
  const text=inputLinksEl.value.trim();
  if(!text){alert("Input kosong!"); return;}
  navigator.clipboard.writeText(text).then(()=>alert("Isi input berhasil disalin!")).catch(()=>alert("Gagal menyalin!"));
});

// Clear/copy toko
document.getElementById('clearInputTokoBtn').addEventListener('click',()=>{ excludedShopsEl.value=''; localStorage.removeItem(`${pageKey}_excludedShops`); processLinks(); });
document.getElementById('copyInputTokoBtn').addEventListener('click',()=>{
  const text=excludedShopsEl.value.trim();
  if(!text){alert("Input kosong!"); return;}
  navigator.clipboard.writeText(text).then(()=>alert("Isi input berhasil disalin!")).catch(()=>alert("Gagal menyalin!"));
});

// Simpan input ke localStorage saat diketik
inputLinksEl.addEventListener('input',()=>{ localStorage.setItem(`${pageKey}_inputLinks`,inputLinksEl.value); processLinks(); });
excludedShopsEl.addEventListener('input',()=>{ localStorage.setItem(`${pageKey}_excludedShops`,excludedShopsEl.value); processLinks(); });

// Fungsi utama
function processLinks(){
  const rawLines=inputLinksEl.value.split('\n').map(l=>l.trim());
  const excludedShopIds=excludedShopsEl.value.split('\n').map(id=>id.trim()).filter(Boolean);
  
  let pages=[], currentLinks=[];
  for(let i=0;i<rawLines.length;i++){
    const line=rawLines[i];
    if(line==='' || line==='###'){ // pemisah halaman
      if(currentLinks.length>0){ pages.push(currentLinks); currentLinks=[]; }
    }else if(/\/product\/\d+\/\d+/.test(line)){
      const match=line.match(/\/product\/(\d+)\/\d+/);
      const shopId=match[1];
      if(!excludedShopIds.includes(shopId)) currentLinks.push(line);
      if(currentLinks.length>=maxPerPage){ pages.push(currentLinks); currentLinks=[]; }
    }
  }
  if(currentLinks.length>0) pages.push(currentLinks);

  allLinks=pages; currentPage=1; showPage(currentPage); renderPagination();

  const totalLinks=rawLines.filter(l=>l && l!=='###').length;
  document.getElementById('stats').textContent=`Total link diinput: ${totalLinks}\nTotal halaman: ${allLinks.length}`;
  document.getElementById('output').style.display=allLinks.length?'block':'none';
}

// Tampilkan halaman dan update unique per toko
function showPage(page){
  if(page<1||page>allLinks.length) return;
  const pageLinks=allLinks[page-1];

  // Output utama
  document.getElementById('output').innerHTML = pageLinks.map(l=>`<a href="${l}" target="_blank" rel="noopener noreferrer">${l}</a>`).join('');

  // Output unik per toko dengan jumlah link per toko
  const shopCountMap = {}; // {shopId: {firstLink, count}}
  pageLinks.forEach(line=>{
    const match=line.match(/\/product\/(\d+)\/\d+/);
    if(match){
      const shopId=match[1];
      if(!shopCountMap[shopId]){
        shopCountMap[shopId] = {firstLink: line, count: 1};
      } else {
        shopCountMap[shopId].count++;
      }
    }
  });

  const uniqueDiv = document.getElementById('uniqueOutput');
  uniqueDiv.innerHTML = Object.values(shopCountMap).map(item =>
    `<a href="${item.firstLink}" target="_blank" rel="noopener noreferrer">${item.firstLink} (Jumlah: ${item.count})</a>`
  ).join('');
  uniqueDiv.style.display = 'none'; // default sembunyi

  currentPage=page; 
  highlightActivePage();
}

// Copy link halaman saat ini
function copyToClipboard(){
  if(!allLinks.length) return;
  const text=allLinks[currentPage-1].join('\n');
  navigator.clipboard.writeText(text).then(()=>alert(`Link di halaman ${currentPage} berhasil disalin!`)).catch(()=>alert('Gagal menyalin!'));
}

// Copy link unik per toko
function copyUniqueOutput(){
  const uniqueDiv=document.getElementById('uniqueOutput');
  const links = Array.from(uniqueDiv.querySelectorAll('a')).map(a=>a.href);
  if(links.length===0){ alert("Tidak ada link unik!"); return; }
  navigator.clipboard.writeText(links.join('\n')).then(()=>alert('Link unik berhasil disalin!')).catch(()=>alert('Gagal menyalin!'));
}

// Toggle tampil/sembunyikan unique output
function toggleUniqueOutput(){
  const div=document.getElementById('uniqueOutput');
  div.style.display = div.style.display==='none'?'block':'none';
}

// Pagination
function renderPagination(){
  const pagination=document.getElementById('pagination');
  pagination.innerHTML='';
  for(let i=1;i<=allLinks.length;i++){
    const btn=document.createElement('button');
    btn.textContent=i; btn.className='page-btn';
    if(i===currentPage) btn.classList.add('active');
    btn.addEventListener('click',()=>showPage(i));
    pagination.appendChild(btn);
  }
}

function highlightActivePage(){
  document.querySelectorAll('.page-btn').forEach(btn=>{
    btn.classList.remove('active'); 
    if(parseInt(btn.textContent)===currentPage) btn.classList.add('active'); 
  });
}
</script>

</body>
</html>
