<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Baca CSV Shopee Tools</title>
<style>
  body {font-family: Arial, sans-serif; margin: 20px; max-width: 900px; margin-inline:auto;}
  h2 {text-align:center;}
  .menu {
    display:flex; gap:10px; flex-wrap:wrap; justify-content:center;
    background:#f1f1f1; padding:10px; border-radius:8px; margin-bottom:20px;
  }
  button, input[type="file"]::file-selector-button {
    padding:8px 15px;
    border:none;
    border-radius:4px;
    cursor:pointer;
    background:#007bff;
    color:white;
    font-weight:bold;
  }
  button:hover, input[type="file"]::file-selector-button:hover {
    background:#0056b3;
  }
  #headerList,#csvTable,#linkSection{margin-top:15px;}
  table {border-collapse:collapse; width:100%;}
  th,td{border:1px solid #aaa; padding:8px;}
  th{background:#eee;}
  tr:nth-child(even){background:#fafafa;}
</style>
</head>
<body>

<h2>üìÇ Pembaca CSV Shopee + Generator Link</h2>

<div class="menu">
  <label><strong>1Ô∏è‚É£ Pilih File:</strong> <input type="file" id="csvFile" accept=".csv"></label>
  <button id="toggleHeaders" style="display:none;">2Ô∏è‚É£ Pilih Kolom</button>
  <button id="showDataBtn" style="display:none;">3Ô∏è‚É£ Tampilkan Data</button>
  <button id="toggleLinks" style="display:none;">4Ô∏è‚É£ Lihat Link Produk</button>
  <button id="copyLinksBtn" style="display:none;">üìã Salin Semua Link</button>
</div>

<div id="headerList" style="display:none;"></div>
<table id="csvTable"></table>
<div id="linkSection" style="display:none;"></div>

<script>
let csvData=[], headers=[];
let sortedData=[]; // üîπ simpan hasil sort untuk digunakan ulang

const defaultChecked=["ID Shop","ID Barang","Total Komisi per Produk(Rp)"];

document.getElementById('csvFile').addEventListener('change',e=>{
  const file=e.target.files[0]; if(!file)return;
  const reader=new FileReader();
  reader.onload=ev=>{
    const rows=ev.target.result.split('\n').map(r=>r.trim()).filter(r=>r);
    csvData=rows.map(r=>r.split(',').map(c=>c.replace(/^"|"$/g,'')));
    headers=csvData[0];

    const hList=document.getElementById('headerList');
    hList.innerHTML='<b>Pilih kolom yang ingin ditampilkan:</b><br><br>';
    headers.forEach((h,i)=>{
      const label=document.createElement('label');
      const checked=defaultChecked.includes(h.trim());
      label.innerHTML=`${i+1}. <input type="checkbox" value="${i}" ${checked?'checked':''}> ${h}`;
      hList.appendChild(label);
      hList.appendChild(document.createElement('br'));
    });

    hList.style.display='block';
    document.getElementById('toggleHeaders').style.display='inline-block';
    document.getElementById('showDataBtn').style.display='inline-block';
  };
  reader.readAsText(file);
});

document.getElementById('toggleHeaders').onclick=()=>{
  const div=document.getElementById('headerList');
  div.style.display=div.style.display==='none'?'block':'none';
};

document.getElementById('showDataBtn').onclick=()=>{
  const checked=Array.from(document.querySelectorAll('#headerList input:checked')).map(cb=>+cb.value);
  const table=document.getElementById('csvTable'); table.innerHTML='';
  if(checked.length===0){table.innerHTML='<tr><td>Tidak ada kolom dipilih</td></tr>';return;}

  const komisiIndex=headers.findIndex(h=>h.trim()==="Total Komisi per Produk(Rp)");
  sortedData=csvData.slice(1); // üîπ Simpan data terurut global

  if(komisiIndex!==-1) {
    sortedData.sort((a,b)=>(parseFloat(b[komisiIndex].replace(/[^\d.-]/g,''))||0)-(parseFloat(a[komisiIndex].replace(/[^\d.-]/g,''))||0));
  }

  const head=document.createElement('tr');
  checked.forEach(i=>{const th=document.createElement('th');th.textContent=headers[i];head.appendChild(th);});
  table.appendChild(head);

  sortedData.forEach(r=>{
    const tr=document.createElement('tr');
    checked.forEach(i=>{const td=document.createElement('td');td.textContent=r[i]||'';tr.appendChild(td);});
    table.appendChild(tr);
  });

  document.getElementById('toggleLinks').style.display='inline-block';
};

document.getElementById('toggleLinks').onclick=()=>{
  const linkSec=document.getElementById('linkSection');
  if(linkSec.innerHTML===''){
    const shopIndex=headers.findIndex(h=>h.trim()==="ID Shop");
    const prodIndex=headers.findIndex(h=>h.trim()==="ID Barang");
    if(shopIndex===-1||prodIndex===-1){linkSec.innerHTML='Kolom ID Shop atau ID Barang tidak ditemukan';return;}
    
    // üîπ gunakan data hasil sort, bukan urutan asli
    const links=sortedData.map(r=>`https://shopee.co.id/product/${r[shopIndex]}/${r[prodIndex]}`);
    linkSec.innerHTML=links.map(l=>`<a href="${l}" target="_blank">${l}</a>`).join('<br>');
    document.getElementById('copyLinksBtn').style.display='inline-block';
  }
  linkSec.style.display=linkSec.style.display==='none'?'block':'none';
};

document.getElementById('copyLinksBtn').onclick=()=>{
  const links=[...document.querySelectorAll('#linkSection a')].map(a=>a.href).join('\n');
  navigator.clipboard.writeText(links);
  alert('‚úÖ Semua link (urut dari komisi tertinggi) berhasil disalin ke clipboard!');
};
</script>

</body>
</html>
