<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Baca CSV Pilih Kolom + Auto Sort + Toggle Menu</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    max-width: 900px;
    margin-left: auto;
    margin-right: auto;
  }
  h2 { text-align: center; }
  #headerList {
    border: 1px solid #ccc;
    border-radius: 6px;
    padding: 10px;
    margin-top: 15px;
    width: fit-content;
    background: #f9f9f9;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    margin-top: 20px;
  }
  th, td {
    border: 1px solid #aaa;
    padding: 8px;
    text-align: left;
  }
  th { background: #eee; }
  tr:nth-child(even) { background: #fafafa; }
  button {
    margin-top: 15px;
    padding: 8px 15px;
    border: none;
    background: #007bff;
    color: white;
    border-radius: 4px;
    cursor: pointer;
  }
  button:hover { background: #0056b3; }
  .hidden { display: none; }
</style>
</head>
<body>

<h2>Baca File CSV dan Pilih Kolom</h2>

<input type="file" id="csvFile" accept=".csv"><br>

<button id="toggleHeaderList" class="hidden">Tampilkan/Sembunyikan Menu Kolom</button>
<div id="headerList" class="hidden"></div>

<button id="showDataBtn" style="display:none;">Tampilkan</button>
<button id="toggleTableBtn" class="hidden">Sembunyikan Hasil</button>

<table id="csvTable"></table>

<script>
let csvData = [];
let headers = [];
const defaultChecked = ["ID Shop", "ID Barang", "Total Komisi per Produk(Rp)"];

document.getElementById('csvFile').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(event) {
    const text = event.target.result;
    const rows = text.split('\n').map(r => r.trim()).filter(r => r);
    csvData = rows.map(r => r.split(',').map(c => c.replace(/^"|"$/g, '')));
    headers = csvData[0];

    const headerDiv = document.getElementById('headerList');
    headerDiv.innerHTML = '<b>Pilih kolom yang ingin ditampilkan:</b><br><br>';

    headers.forEach((h, i) => {
      const label = document.createElement('label');
      const isChecked = defaultChecked.includes(h.trim());
      label.innerHTML = `${i + 1}. <input type="checkbox" value="${i}" ${isChecked ? 'checked' : ''}> ${h}`;
      headerDiv.appendChild(label);
      headerDiv.appendChild(document.createElement('br'));
    });

    document.getElementById('toggleHeaderList').classList.remove('hidden');
    document.getElementById('headerList').classList.remove('hidden');
    document.getElementById('showDataBtn').style.display = 'inline-block';
    document.getElementById('csvTable').innerHTML = '';
  };
  reader.readAsText(file);
});

document.getElementById('toggleHeaderList').addEventListener('click', () => {
  document.getElementById('headerList').classList.toggle('hidden');
});

document.getElementById('showDataBtn').addEventListener('click', function() {
  const checkedIndexes = Array.from(document.querySelectorAll('#headerList input[type="checkbox"]:checked'))
    .map(cb => parseInt(cb.value));

  const table = document.getElementById('csvTable');
  table.innerHTML = '';

  if (checkedIndexes.length === 0) {
    table.innerHTML = '<tr><td colspan="99" style="text-align:center;">Tidak ada kolom dipilih</td></tr>';
    return;
  }

  const komisiIndex = headers.findIndex(h => h.trim() === "Total Komisi per Produk(Rp)");

  let dataToShow = csvData.slice(1);
  if (komisiIndex !== -1) {
    dataToShow.sort((a, b) => {
      const valA = parseFloat(a[komisiIndex]?.replace(/[^\d.-]/g, "")) || 0;
      const valB = parseFloat(b[komisiIndex]?.replace(/[^\d.-]/g, "")) || 0;
      return valB - valA;
    });
  }

  const headerRow = document.createElement('tr');
  checkedIndexes.forEach(i => {
    const th = document.createElement('th');
    th.textContent = headers[i];
    headerRow.appendChild(th);
  });
  table.appendChild(headerRow);

  dataToShow.forEach(row => {
    const tr = document.createElement('tr');
    checkedIndexes.forEach(i => {
      const td = document.createElement('td');
      td.textContent = row[i] || '';
      tr.appendChild(td);
    });
    table.appendChild(tr);
  });

  document.getElementById('toggleTableBtn').classList.remove('hidden');
  document.getElementById('csvTable').classList.remove('hidden');
});

document.getElementById('toggleTableBtn').addEventListener('click', function() {
  const table = document.getElementById('csvTable');
  const isHidden = table.classList.toggle('hidden');
  this.textContent = isHidden ? 'Tampilkan Hasil' : 'Sembunyikan Hasil';
});
</script>

</body>
</html>
