<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Tampilkan productLink dari Banyak CSV</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px auto;
    max-width: 800px;
    background: #f7f7f9;
  }
  h2 { text-align: center; margin-bottom: 15px; }
  input[type="file"], button {
    display: block;
    margin: 10px auto;
  }
  #linksBox {
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 10px;
    padding: 12px;
    min-height: 150px;
    white-space: pre-wrap;
    overflow-y: auto;
    font-family: monospace;
    font-size: 14px;
  }
  button.copy-all {
    background: #007bff;
    color: white;
    border: none;
    padding: 8px 14px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
  }
  button.copy-all:hover { background: #0056b3; }
  #report {
    margin-top: 10px;
    text-align: center;
    font-size: 14px;
    color: #444;
  }
  #report span { font-weight: bold; }
</style>
</head>
<body>

<h2>Gabung & Tampilkan Kolom <code>productLink</code> dari Beberapa CSV</h2>
<input type="file" id="csvFile" accept=".csv" multiple />
<button class="copy-all" id="copyAllBtn" style="display:none;">Copy Semua Link Unik</button>

<div id="linksBox">(Data akan muncul di sini setelah memilih file CSV)</div>
<div id="report"></div>

<script>
let allLinks = "";

// Fungsi untuk memproses isi CSV
function parseCSV(text) {
  const rows = text.split(/\r?\n/).filter(row => row.trim() !== '');
  const headers = rows[0].split(',').map(h => h.trim().replace(/^"|"$/g, ''));
  const productIndex = headers.indexOf('productLink');
  const links = [];

  if (productIndex === -1) return links;

  for (let i = 1; i < rows.length; i++) {
    const cols = rows[i].split(',');
    let link = cols[productIndex]?.trim().replace(/^"|"$/g, '');
    if (link) links.push(link);
  }
  return links;
}

document.getElementById('csvFile').addEventListener('change', async function(e) {
  const files = Array.from(e.target.files);
  if (files.length === 0) return;

  let combinedLinks = [];
  let totalRead = 0;

  for (const file of files) {
    const text = await file.text();
    const links = parseCSV(text);
    combinedLinks = combinedLinks.concat(links);
    totalRead += links.length;
  }

  // Hapus duplikat
  const uniqueLinks = [...new Set(combinedLinks)];
  const duplikat = totalRead - uniqueLinks.length;

  allLinks = uniqueLinks.join('\n');
  document.getElementById('linksBox').textContent = allLinks;
  document.getElementById('copyAllBtn').style.display = uniqueLinks.length ? 'block' : 'none';

  // Laporan hasil
  let reportText = `<span>Total link dari semua file:</span> ${totalRead} | `;
  reportText += `<span>Unik:</span> ${uniqueLinks.length}`;
  if (duplikat > 0) {
    reportText += ` | ⚠️ <span>Duplikat dihapus:</span> ${duplikat}`;
  } else {
    reportText += ` | ✅ Tidak ada duplikat`;
  }
  document.getElementById('report').innerHTML = reportText;
});

document.getElementById('copyAllBtn').addEventListener('click', function() {
  if (!allLinks) return;
  navigator.clipboard.writeText(allLinks).then(() => {
    alert('✅ Semua link unik berhasil disalin ke clipboard!');
  });
});
</script>

</body>
</html>
