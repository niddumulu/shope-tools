<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Produk Laku di Live MadGazan</title>
<style>
  body {font-family: Arial, sans-serif; margin: 20px; max-width: 800px; margin-inline:auto;}
  h2 {text-align: center;}
  textarea {width: 100%; height: 120px; margin-bottom: 10px;}
  button, select {margin: 3px; padding: 5px 10px;}
  .pagination button {margin: 2px;}
  .link-item {padding: 3px 0; border-bottom: 1px solid #eee;}
</style>
</head>
<body>

<h2>Produk Laku di Live MadGazan</h2>

<!-- Dropdown -->
<label for="fileDropdown">Pilih File TXT:</label>
<select id="fileDropdown">
  <option value="">-- Pilih File --</option>
  <option value="rini.txt">rini.txt</option>
  <option value="jalb.txt">jalb.txt</option>
  <option value="mad.txt">mad.txt</option>
</select>

<!-- Tombol aksi -->
<div class="actions">
  <button id="ambilFileBtn">Ambil File</button>
  <button id="hapusDuplikatBtn">Hapus Duplikat</button>
  <button id="copyInputBtn">Salin Input</button>
  <button id="clearInputBtn">Hapus Input</button>
</div>

<!-- Textarea -->
<textarea id="inputLinks" placeholder="Masukkan atau hasil ambil dari file TXT..."></textarea>

<!-- Statistik -->
<div id="stats"></div>

<!-- Output -->
<div id="output"></div>

<!-- Pagination -->
<div id="pagination" class="pagination"></div>

<script>
const MAX_PER_PAGE = 100;
let allPages = [];
let currentPage = 1;

const dropdown = document.getElementById('fileDropdown');
const inputLinks = document.getElementById('inputLinks');
const output = document.getElementById('output');
const stats = document.getElementById('stats');
const pagination = document.getElementById('pagination');

// Load awal
window.addEventListener('load', () => {
  const savedFile = localStorage.getItem('selectedFile');
  if (savedFile) dropdown.value = savedFile;
  restoreData();
});

// Ubah file dropdown
dropdown.addEventListener('change', () => {
  localStorage.setItem('selectedFile', dropdown.value);
  restoreData();
});

// Tombol ambil file
document.getElementById('ambilFileBtn').addEventListener('click', async () => {
  const file = dropdown.value;
  if (!file) return alert('Pilih file dulu!');
  try {
    const res = await fetch(file + '?t=' + Date.now(), {cache: 'no-store'});
    const text = await res.text();
    inputLinks.value = text.trim();
    localStorage.setItem('inputList_' + file, inputLinks.value);
    processLinks();
    alert('Berhasil mengambil: ' + file);
  } catch (err) {
    alert('Gagal ambil file: ' + err.message);
  }
});

// Tombol hapus duplikat
document.getElementById('hapusDuplikatBtn').addEventListener('click', () => {
  const lines = inputLinks.value.split('\n').map(l => l.trim()).filter(Boolean);
  const unique = [...new Set(lines)];
  inputLinks.value = unique.join('\n');
  const file = dropdown.value;
  if (file) localStorage.setItem('inputList_' + file, inputLinks.value);
  processLinks();
  alert('Duplikat dihapus!');
});

// Tombol salin input
document.getElementById('copyInputBtn').addEventListener('click', () => {
  navigator.clipboard.writeText(inputLinks.value).then(() => alert('Disalin ke clipboard!'));
});

// Tombol hapus input
document.getElementById('clearInputBtn').addEventListener('click', () => {
  inputLinks.value = '';
  const file = dropdown.value;
  if (file) localStorage.removeItem('inputList_' + file);
  processLinks();
});

// Input manual
inputLinks.addEventListener('input', () => {
  const file = dropdown.value;
  if (file) localStorage.setItem('inputList_' + file, inputLinks.value);
  processLinks();
});

function restoreData() {
  const file = dropdown.value;
  const savedInput = localStorage.getItem('inputList_' + file);
  const savedPage = parseInt(localStorage.getItem('currentPage_' + file) || '1');
  inputLinks.value = savedInput || '';
  processLinks();
  if (savedPage > 0) {
    currentPage = savedPage;
    showPage(currentPage);
  }
}

function processLinks() {
  const raw = inputLinks.value.split('\n').map(l => l.trim()).filter(Boolean);
  const unique = [...new Set(raw)];
  const duplicateCount = raw.length - unique.length;

  allPages = [];
  for (let i = 0; i < unique.length; i += MAX_PER_PAGE) {
    allPages.push(unique.slice(i, i + MAX_PER_PAGE));
  }

  if (currentPage > allPages.length) currentPage = 1;
  showPage(currentPage);
  stats.innerHTML = `
    Total baris: ${raw.length}<br>
    Unik: ${unique.length}<br>
    Duplikat: ${duplicateCount}<br>
    Total halaman: ${allPages.length}
  `;
  renderPagination();
}

function showPage(page) {
  const file = dropdown.value;
  if (file) localStorage.setItem('currentPage_' + file, page);
  currentPage = page;
  const items = allPages[page - 1] || [];
  output.innerHTML = items.map(l => `<div class="link-item"><a href="${l}" target="_blank">${l}</a></div>`).join('');
}

function renderPagination() {
  pagination.innerHTML = '';
  for (let i = 1; i <= allPages.length; i++) {
    const btn = document.createElement('button');
    btn.textContent = i;
    if (i === currentPage) btn.style.fontWeight = 'bold';
    btn.addEventListener('click', () => showPage(i));
    pagination.appendChild(btn);
  }
}
</script>

</body>
</html>
