<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Produk Live MadGazan</title>
<style>
/* ... (SEMUA CSS ASLI TETAP SAMA) ... */
</style>
</head>
<body>

<h1>Produk Live MadGazan 8 November 2025</h1>
<h2>Manajemen Shopee Live V7</h2>

<textarea id="inputLinks" placeholder="Masukkan ribuan link produk Shopee, satu per baris..."></textarea>

<div class="input-buttons">
  <button id="clearInputLinksBtn">Clear Input Links</button>
  <button id="copyInputLinksBtn">Copy Input Links</button>
  <button id="hapusDuplikatBtn">Hapus Duplikat</button>
  <button id="sortirPerTokoBtn">Sortir Berdasarkan Toko</button>
</div>

<!-- ✅ Tambahan: Input Produk Habis -->
<h3>Daftar Produk Habis (Masukkan ID produk, satu per baris)</h3>
<textarea id="inputHabis" placeholder="Contoh:\n26821351065\n123456789..."></textarea>
<div class="input-buttons">
  <button id="updateHabisBtn">Update Produk Habis</button>
  <button id="clearHabisBtn">Clear Daftar Habis</button>
</div>
<!-- ✅ Selesai tambahan -->

<h3>Daftar File TXT Produk</h3>
<select id="fileDropdown">
  <option value="">-- Pilih File TXT --</option>
  <option value="jalb.txt">jalb.txt</option>
  <option value="rano.txt">rano.txt</option>
  <option value="indah.txt">kakfitro.txt</option>
  <option value="rini.txt">rini.txt</option>
  <option value="nurbad.txt">nurbad.txt</option>
</select>
<div id="updateNotice" style="margin:10px 0; font-weight:bold;"></div>
<div class="input-buttons">
  <button id="ambilFileListLinksBtn">Download Terbaru Masal</button>
</div>

<div class="sponsor">
  Disponsori oleh <strong>MadGazan Studio</strong><br>
</div>

<div id="stats"></div>

<h3>Output (Produk Siap Live)</h3>
<div id="output"></div>
<button id="copyBtn" onclick="copyToClipboard()">Copy Link di Halaman Ini</button>

<div class="pagination" id="pagination"></div>

<div class="backup-area">
  <!-- ... (bagian backup tetap sama) ... -->
</div>

<footer>
  © 2025 MadGazan Studio — Semua Hak Dilindungi
</footer>

<div id="toast"></div>

<script>
const MAX_PER_PAGE = 99;
const PAGE_OFFSET = 0;
let allPages = [];
let currentPage = 1;

// ✅ Tambahan untuk produk habis
let habisList = [];
let habisPages = [];
// ================================

const inputLinksEl = document.getElementById('inputLinks');
const statsEl = document.getElementById('stats');
const outputEl = document.getElementById('output');
const paginationEl = document.getElementById('pagination');
const dropdownEl = document.getElementById('fileDropdown');
const inputHabisEl = document.getElementById('inputHabis'); // ✅

/* === Toast === */
function showToast(message, color = '#333') {
  const toast = document.getElementById('toast');
  toast.textContent = message;
  toast.style.background = color;
  toast.style.opacity = '1';
  toast.style.transform = 'translateY(0)';
  setTimeout(() => {
    toast.style.opacity = '0';
    toast.style.transform = 'translateY(20px)';
  }, 4000);
}

/* ===== Penyimpanan Data ===== */
function getStorageKey() {
  const f = dropdownEl.value || 'default';
  return 'appData_' + f;
}
function saveAppData() {
  const key = getStorageKey();
  const data = { 
    inputList: inputLinksEl.value, 
    habisList: inputHabisEl.value, // ✅ simpan habis
    currentPage: currentPage 
  };
  localStorage.setItem(key, JSON.stringify(data));
}
function loadAppData() {
  const key = getStorageKey();
  const data = JSON.parse(localStorage.getItem(key) || '{}');
  if (data.inputList) inputLinksEl.value = data.inputList;
  if (data.habisList) inputHabisEl.value = data.habisList; // ✅ load habis
  currentPage = data.currentPage || 1;
}

/* ===== Input Produk Habis ===== */
document.getElementById('updateHabisBtn').addEventListener('click', () => {
  habisList = inputHabisEl.value.split('\n').map(x => x.trim()).filter(Boolean);
  processLinks();
  showToast(`✅ Daftar habis diperbarui (${habisList.length} item)`, '#008000');
  saveAppData();
});
document.getElementById('clearHabisBtn').addEventListener('click', () => {
  inputHabisEl.value = '';
  habisList = [];
  processLinks();
  saveAppData();
  showToast('Daftar produk habis dikosongkan.', '#b36b00');
});

/* ===== Proses Link ===== */
function processLinks() {
  const raw = inputLinksEl.value.split('\n').map(l => l.trim()).filter(Boolean);
  const unique = [...new Set(raw)];
  const dup = raw.length - unique.length;

  // ✅ Pisahkan produk habis
  const normalLinks = [];
  const soldOutLinks = [];
  for (let link of unique) {
    const match = link.match(/product\/(\d+)\/(\d+)/);
    if (match) {
      const productId = match[2];
      if (habisList.includes(productId)) soldOutLinks.push(link);
      else normalLinks.push(link);
    } else {
      normalLinks.push(link);
    }
  }

  allPages = [];
  habisPages = [];

  // Bagi halaman normal
  for (let i = 0; i < normalLinks.length; i += MAX_PER_PAGE) {
    allPages.push(normalLinks.slice(i, i + MAX_PER_PAGE));
  }

  // Bagi halaman habis (setelah halaman biasa)
  for (let i = 0; i < soldOutLinks.length; i += MAX_PER_PAGE) {
    habisPages.push(soldOutLinks.slice(i, i + MAX_PER_PAGE));
  }

  renderStats(raw.length, unique.length, dup, soldOutLinks.length);
  renderPagination();
  if (currentPage > allPages.length + habisPages.length) currentPage = 1;
  showPage(currentPage);
}

function renderStats(total, uniq, dup, habisCount = 0) {
  statsEl.textContent =
    `Total link diinput: ${total}
Link unik: ${uniq}
Duplikat dihapus: ${dup}
Produk habis: ${habisCount}
Total halaman: ${allPages.length + habisPages.length}`;
}

/* ===== Pagination + Tampilan ===== */
function showPage(page) {
  let isHabisPage = false;
  let data;
  if (page <= allPages.length) {
    data = allPages[page - 1];
  } else {
    isHabisPage = true;
    data = habisPages[page - allPages.length - 1];
  }

  if (!data || !data.length) { outputEl.style.display = 'none'; return; }

  const fileNow = dropdownEl.value || 'default.txt';
  outputEl.innerHTML = data.map(l => {
    const reportUrl = `https://niddumulu.github.io/shope-tools/lapor/index.html?link=${encodeURIComponent(l)}&file=${encodeURIComponent(fileNow)}`;
    return `<div class="link-item" style="${isHabisPage ? 'background:#ffe5e5;' : ''}">
              <a class="link" href="${l}" target="_blank">${l}</a>
              ${isHabisPage ? '<span style="color:#cc0000;font-weight:bold;">(Habis)</span>' : ''}
              <a class="report" href="${reportUrl}" target="_blank">Laporkan</a>
            </div>`;
  }).join('');
  outputEl.style.display = 'block';
  currentPage = page;
  highlightActivePage();
  saveAppData();
}

function renderPagination() {
  paginationEl.innerHTML = '';
  const totalNormal = allPages.length;
  const totalHabis = habisPages.length;

  for (let i = 1; i <= totalNormal; i++) {
    const btn = document.createElement('button');
    btn.textContent = i + PAGE_OFFSET;
    btn.className = 'page-btn';
    if (i === currentPage) btn.classList.add('active');
    btn.onclick = () => showPage(i);
    paginationEl.appendChild(btn);
  }

  // ✅ Tambahkan halaman "Habis"
  for (let i = 1; i <= totalHabis; i++) {
    const btn = document.createElement('button');
    btn.textContent = `Habis ${i}`;
    btn.className = 'page-btn';
    if (totalNormal + i === currentPage) btn.classList.add('active');
    btn.onclick = () => showPage(totalNormal + i);
    paginationEl.appendChild(btn);
  }
}

function highlightActivePage() {
  document.querySelectorAll('.page-btn').forEach((btn, index) => {
    btn.classList.toggle('active', index + 1 === currentPage);
  });
}

/* ===== Copy ===== */
function copyToClipboard() {
  let data;
  if (currentPage <= allPages.length) {
    data = allPages[currentPage - 1];
  } else {
    data = habisPages[currentPage - allPages.length - 1];
  }
  if (!data) return showToast('Tidak ada link!', '#cc0000');
  navigator.clipboard.writeText(data.join('\n')).then(() => showToast('✅ Link halaman ini disalin!', '#008000'));
}

/* ===== Load Awal ===== */
window.addEventListener('load', () => {
  const savedDropdown = localStorage.getItem('selectedFile');
  if (savedDropdown) dropdownEl.value = savedDropdown;
  loadAppData();
  habisList = inputHabisEl.value.split('\n').map(x => x.trim()).filter(Boolean);
  processLinks();
  setTimeout(checkForUpdates, 2000);
});

/* ===== Tombol & Sinkronisasi tetap sama ===== */
// ... (kode lain tetap tidak diubah)
</script>
</body>
</html>
