<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Produk Live MadGazan</title>
<style>
  body { font-family: Arial, sans-serif; margin: 15px; max-width: 900px; margin-inline:auto; background-color:#fffef9; }
  h1,h2,h3 { color:#b36b00; text-align:center; }
  textarea, select { width:100%; box-sizing:border-box; font-size:1rem; padding:8px; border-radius:6px; border:1px solid #ccc; resize:vertical; }
  textarea { height:150px; }
  #output { display:none; margin-top:10px; background:#fff; border-radius:8px; border:1px solid #ffd42a; padding:10px 15px; box-shadow:0 0 8px rgba(255,212,42,0.2);}
  .link-item { display:flex; justify-content:space-between; align-items:center; background:#fffbec; padding:8px 10px; border-bottom:1px dashed #ffd42a; border-radius:5px; margin-bottom:6px; }
  .link-item.habis { background:#ffe5e5; }
  .link-item a.link { color:#0066cc; text-decoration:none; word-break:break-all; flex:1; }
  .link-item a.link:hover { text-decoration:underline; }
  .link-item a.report { color:#cc0000; text-decoration:none; font-weight:bold; margin-left:10px; white-space:nowrap; }
  .pagination { margin-top:15px; text-align:center; display:flex; flex-wrap:wrap; gap:6px; justify-content:center; }
  .page-btn { padding:10px 14px; cursor:pointer; border:1px solid #ccc; border-radius:6px; background-color:white; font-size:1rem; }
  .page-btn:hover { background-color:#ffd42a; color:#b36b00; }
  .active { font-weight:bold; background-color:#ffd42a; color:#b36b00; border-color:#b36b00; }
  #copyBtn { margin-top:12px; padding:12px; font-size:1rem; cursor:pointer; border:none; background-color:#ffd42a; color:#b36b00; border-radius:6px; width:100%; }
  #copyBtn:hover { background-color:#e6c72b; }
  .input-buttons { display:flex; gap:8px; margin-top:6px; flex-wrap:wrap; }
  .input-buttons button { flex:1; padding:10px; font-size:0.95rem; cursor:pointer; border:1px solid #ccc; border-radius:6px; background:#f5f5f5; }
  #stats { margin:15px 0; font-weight:bold; font-size:1rem; white-space:pre-line; }
  .sponsor { background-color:#fffae6; border:1px solid #ffd42a; padding:12px; margin:15px 0; font-weight:bold; text-align:center; color:#b36b00; border-radius:6px; }
  footer { text-align:center; margin-top:25px; font-size:0.9rem; color:#888; }
  #toast { position: fixed; bottom: 25px; right: 25px; background: #333; color: #fff; padding: 12px 20px; border-radius: 8px; box-shadow:0 2px 10px rgba(0,0,0,0.3); opacity:0; transform:translateY(20px); transition:opacity .4s,transform .4s; z-index:9999; }
</style>
</head>
<body>

<h1>Produk Live MadGazan 8 November 2025</h1>
<h2>Manajemen Shopee Live V7</h2>

<textarea id="inputLinks" placeholder="Masukkan ribuan link produk Shopee, satu per baris..."></textarea>

<div class="input-buttons">
  <button id="clearInputLinksBtn">Clear Input Links</button>
  <button id="copyInputLinksBtn">Copy Input Links</button>
  <button id="hapusDuplikatBtn">Hapus Duplikat</button>
  <button id="sortirPerTokoBtn">Sortir Berdasarkan Toko</button>
</div>

<!-- ✅ Input Produk Habis -->
<h3>Produk Habis</h3>
<textarea id="inputHabis" placeholder="Masukkan link produk habis, satu per baris..."></textarea>
<div class="input-buttons">
  <button id="updateHabisBtn">Filter Produk Habis</button>
  <button id="clearHabisBtn">Clear Produk Habis</button>
</div>

<h3>Daftar File TXT Produk</h3>
<select id="fileDropdown">
  <option value="">-- Pilih File TXT --</option>
  <option value="jalb.txt">jalb.txt</option>
  <option value="rano.txt">rano.txt</option>
  <option value="indah.txt">kakfitro.txt</option>
  <option value="rini.txt">rini.txt</option>
  <option value="nurbad.txt">nurbad.txt</option>
</select>
<div id="updateNotice" style="margin:10px 0; font-weight:bold;"></div>
<div class="input-buttons">
  <button id="ambilFileListLinksBtn">Download Terbaru Masal</button>
</div>

<div class="sponsor">Disponsori oleh <strong>MadGazan Studio</strong></div>

<div id="stats"></div>

<h3>Output (Produk Siap Live)</h3>
<div id="output"></div>
<button id="copyBtn" onclick="copyToClipboard()">Copy Link di Halaman Ini</button>

<div class="pagination" id="pagination"></div>

<footer>© 2025 MadGazan Studio — Semua Hak Dilindungi</footer>

<div id="toast"></div>

<script>
const MAX_PER_PAGE = 99;
let allPages = [], habisPages = [];
let currentPage = 1;
let habisLinks = [];

const inputLinksEl = document.getElementById('inputLinks');
const inputHabisEl = document.getElementById('inputHabis');
const statsEl = document.getElementById('stats');
const outputEl = document.getElementById('output');
const paginationEl = document.getElementById('pagination');
const dropdownEl = document.getElementById('fileDropdown');

/* ===== Toast ===== */
function showToast(msg, color='#333'){const t=document.getElementById('toast');t.textContent=msg;t.style.background=color;t.style.opacity='1';t.style.transform='translateY(0)';setTimeout(()=>{t.style.opacity='0';t.style.transform='translateY(20px)';},3500);}

/* ===== Penyimpanan ===== */
function getStorageKey(){return 'appData_'+(dropdownEl.value||'default');}
function saveAppData(){
  const key=getStorageKey();
  const data={inputList:inputLinksEl.value,habisList:inputHabisEl.value,currentPage};
  localStorage.setItem(key,JSON.stringify(data));
}
function loadAppData(){
  const key=getStorageKey();
  const data=JSON.parse(localStorage.getItem(key)||'{}');
  inputLinksEl.value=data.inputList||''; 
  inputHabisEl.value=data.habisList||'';
  currentPage=data.currentPage||1;
}

/* ===== Proses Data ===== */
function processLinks(){
  const raw=inputLinksEl.value.split('\n').map(x=>x.trim()).filter(Boolean);
  const habisRaw=inputHabisEl.value.split('\n').map(x=>x.trim()).filter(Boolean);
  habisLinks=habisRaw;
  const unique=[...new Set(raw)];
  const dup=raw.length-unique.length;

  const normal=[], habis=[];
  for(let link of unique){
    if(habisRaw.some(h=>h===link)) habis.push(link);
    else normal.push(link);
  }

  allPages=[]; habisPages=[];
  for(let i=0;i<normal.length;i+=MAX_PER_PAGE) allPages.push(normal.slice(i,i+MAX_PER_PAGE));
  for(let i=0;i<habis.length;i+=MAX_PER_PAGE) habisPages.push(habis.slice(i,i+MAX_PER_PAGE));

  renderStats(raw.length,unique.length,dup,habis.length);
  renderPagination();
  if(currentPage>allPages.length+habisPages.length) currentPage=1;
  showPage(currentPage);
}
function renderStats(total,uniq,dup,habisCount=0){
  statsEl.textContent=`Total link diinput: ${total}
Link unik: ${uniq}
Duplikat dihapus: ${dup}
Produk habis: ${habisCount}
Total halaman: ${allPages.length+habisPages.length}`;
}

/* ===== Tampilkan Halaman ===== */
function showPage(page){
  let data,isHabis=false;
  if(page<=allPages.length) data=allPages[page-1];
  else{data=habisPages[page-allPages.length-1];isHabis=true;}
  if(!data){outputEl.style.display='none';return;}

  const fileNow=dropdownEl.value||'default.txt';
  outputEl.innerHTML=data.map(l=>{
    const rUrl=`https://niddumulu.github.io/shope-tools/lapor/index.html?link=${encodeURIComponent(l)}&file=${encodeURIComponent(fileNow)}`;
    return `<div class="link-item${isHabis?' habis':''}">
              <a class="link" href="${l}" target="_blank">${l}</a>
              ${isHabis?'<span style="color:#cc0000;font-weight:bold;">(Habis)</span>':''}
              <a class="report" href="${rUrl}" target="_blank">Laporkan</a>
            </div>`;
  }).join('');
  outputEl.style.display='block';
  currentPage=page;
  highlightActivePage();
  saveAppData();
}
function renderPagination(){
  paginationEl.innerHTML='';
  for(let i=1;i<=allPages.length;i++){
    const b=document.createElement('button');
    b.textContent=i; b.className='page-btn';
    if(i===currentPage) b.classList.add('active');
    b.onclick=()=>showPage(i);
    paginationEl.appendChild(b);
  }
  for(let i=1;i<=habisPages.length;i++){
    const b=document.createElement('button');
    b.textContent='Habis '+i; b.className='page-btn';
    if(allPages.length+i===currentPage) b.classList.add('active');
    b.onclick=()=>showPage(allPages.length+i);
    paginationEl.appendChild(b);
  }
}
function highlightActivePage(){
  document.querySelectorAll('.page-btn').forEach((b,i)=>b.classList.toggle('active',i+1===currentPage));
}

/* ===== Tombol Dasar ===== */
document.getElementById('clearInputLinksBtn').onclick=()=>{inputLinksEl.value='';processLinks();saveAppData();showToast('Input dikosongkan','#b36b00');};
document.getElementById('copyInputLinksBtn').onclick=()=>{if(!inputLinksEl.value)return showToast('Input kosong!','#c00');navigator.clipboard.writeText(inputLinksEl.value.trim());showToast('✅ Input disalin!','#080');};
document.getElementById('hapusDuplikatBtn').onclick=()=>{const l=[...new Set(inputLinksEl.value.split('\n').map(x=>x.trim()).filter(Boolean))];inputLinksEl.value=l.join('\n');processLinks();saveAppData();showToast('✅ Duplikat dihapus!','#080');};
document.getElementById('sortirPerTokoBtn').onclick=()=>{const lines=inputLinksEl.value.split('\n').map(l=>l.trim()).filter(Boolean);const toko=new Map();for(let link of lines){const m=link.match(/product\/(\d+)\//);if(m&&!toko.has(m[1]))toko.set(m[1],link);}inputLinksEl.value=Array.from(toko.values()).join('\n');processLinks();saveAppData();showToast('✅ Sortir selesai!','#080');};

/* ===== Tombol Produk Habis ===== */
document.getElementById('updateHabisBtn').onclick=()=>{processLinks();saveAppData();showToast('✅ Filter produk habis diterapkan!','#080');};
document.getElementById('clearHabisBtn').onclick=()=>{inputHabisEl.value='';processLinks();saveAppData();showToast('Daftar produk habis dikosongkan.','#b36b00');};

/* ===== Copy Halaman ===== */
function copyToClipboard(){
  let data;
  if(currentPage<=allPages.length)data=allPages[currentPage-1];
  else data=habisPages[currentPage-allPages.length-1];
  if(!data)return showToast('Tidak ada link!','#c00');
  navigator.clipboard.writeText(data.join('\n')).then(()=>showToast('✅ Disalin!','#080'));
}

/* ===== Load Awal ===== */
window.addEventListener('load',()=>{loadAppData();processLinks();});

/* ===== Dropdown Sinkron tetap berfungsi (tanpa ubah fungsi lain) ===== */
dropdownEl.addEventListener('change',()=>{saveAppData();processLinks();});
</script>
</body>
</html>
