<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Filter & Hapus Berdasarkan ID Produk Shopee</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px auto; max-width: 900px; background: #fffef9; color: #333; }
  h1 { text-align:center; color:#b36b00; margin-bottom:10px; }
  textarea {
    width:100%; padding:10px; font-size:1rem; border:1px solid #ccc;
    border-radius:6px; resize:vertical; height:100px; box-sizing:border-box;
  }
  .filter-area {
    background:#fffbe6; border:1px solid #ffd42a; border-radius:8px;
    padding:15px; margin-bottom:20px;
  }
  button {
    padding:10px 16px; font-size:0.95rem; border:none; border-radius:6px;
    cursor:pointer; background:#ffd42a; color:#b36b00; margin-top:10px;
  }
  button:hover { background:#e6c72b; }
  #output {
    background:#fff; border:1px solid #ffd42a; border-radius:8px;
    padding:10px 15px; box-shadow:0 0 5px rgba(255,212,42,0.3);
    margin-top:15px; white-space:pre-line;
  }
  .link-item { border-bottom:1px dashed #ffd42a; padding:6px 0; word-break:break-all; }
  .pagination { margin-top:15px; text-align:center; display:flex; gap:6px; flex-wrap:wrap; justify-content:center; }
  .page-btn { padding:8px 12px; border:1px solid #ccc; border-radius:6px; background:#fff; cursor:pointer; }
  .page-btn:hover { background:#ffd42a; color:#b36b00; }
  .active { background:#ffd42a; color:#b36b00; border-color:#b36b00; font-weight:bold; }
  #toast {
    position:fixed; bottom:25px; right:25px; background:#333; color:#fff;
    padding:12px 20px; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.3);
    opacity:0; transform:translateY(20px);
    transition:opacity 0.4s, transform 0.4s;
    z-index:9999; max-width:320px; white-space:pre-line; line-height:1.3;
  }
</style>
</head>
<body>

<h1>Filter & Hapus Berdasarkan ID Produk Shopee</h1>

<div class="filter-area">
  <p><strong>Masukkan ID produk Shopee</strong> (pisah koma, baris baru, atau masukkan link produk).  
  Contoh: <code>22679185935</code> atau <code>https://shopee.co.id/product/944974083/22679185935</code></p>
  <textarea id="idsInput" placeholder="Masukkan ID produk di sini..."></textarea>
  <button id="applyBtn">ðŸ’¾ Simpan / Terapkan Hapus Permanen</button>
</div>

<div id="stats"></div>
<div id="output"></div>
<div class="pagination" id="pagination"></div>

<div id="toast"></div>

<script>
const MAX_PER_PAGE = 99;
let allLinks = []; 
let allPages = [];
let currentPage = 1;

/* ===== TOAST ===== */
function showToast(msg,color="#333"){
  const t=document.getElementById("toast");
  t.textContent=msg; t.style.background=color;
  t.style.opacity="1"; t.style.transform="translateY(0)";
  setTimeout(()=>{t.style.opacity="0";t.style.transform="translateY(20px)";},4000);
}

/* ===== Ambil semua data dari localStorage ===== */
function loadAllData(){
  const result=[];
  for(let i=0;i<localStorage.length;i++){
    const key=localStorage.key(i);
    try{
      const data=JSON.parse(localStorage.getItem(key));
      if(data && data.inputList){
        const lines=data.inputList.split("\n").map(l=>l.trim()).filter(Boolean);
        result.push(...lines);
      }
    }catch{}
  }
  return [...new Set(result)];
}

/* ===== Parse ID produk dari input ===== */
function parseIds(){
  const raw=document.getElementById('idsInput').value.trim();
  if(!raw) return [];
  const parts=raw.split(/[\n,; ]+/).map(s=>s.trim()).filter(Boolean);
  const ids=[];
  for(const p of parts){
    const match=p.match(/product\/\d+\/(\d+)/);
    if(match){ ids.push(match[1]); continue; }
    const digits=p.replace(/\D/g,'');
    if(digits.length>=5) ids.push(digits);
  }
  return Array.from(new Set(ids));
}

/* ===== Simpan ID produk ke local ===== */
function saveFilterInput(){
  localStorage.setItem('filter_produk_ids', document.getElementById('idsInput').value);
}

/* ===== Terapkan filter dan tampilkan ===== */
function processAndRender(){
  const ids=parseIds();
  let filtered=loadAllData();
  if(ids.length){
    filtered=filtered.filter(link=>{
      const match=link.match(/product\/\d+\/(\d+)/);
      const id=match?match[1]:'';
      return !ids.includes(id);
    });
  }
  allLinks=filtered;
  renderPages();
}

/* ===== Render dengan pagination ===== */
function renderPages(){
  allPages=[];
  for(let i=0;i<allLinks.length;i+=MAX_PER_PAGE)
    allPages.push(allLinks.slice(i,i+MAX_PER_PAGE));
  if(currentPage>allPages.length) currentPage=1;
  renderStats();
  renderPagination();
  showPage(currentPage);
}

function renderStats(){
  const stats=document.getElementById('stats');
  stats.innerHTML=`<strong>Total link tersimpan:</strong> ${allLinks.length}<br>
                   <strong>Total halaman:</strong> ${allPages.length}`;
}

function showPage(page){
  if(!allPages.length){ 
    document.getElementById('output').innerHTML='<em>Tidak ada data ditemukan.</em>';
    document.getElementById('pagination').innerHTML='';
    return;
  }
  currentPage=page;
  document.getElementById('output').innerHTML=allPages[page-1]
    .map(l=>`<div class="link-item">${l}</div>`).join('');
  document.querySelectorAll('.page-btn').forEach((b,i)=>{
    b.classList.toggle('active',i+1===page);
  });
}

function renderPagination(){
  const pag=document.getElementById('pagination');
  pag.innerHTML='';
  for(let i=1;i<=allPages.length;i++){
    const btn=document.createElement('button');
    btn.textContent=i;
    btn.className='page-btn'+(i===currentPage?' active':'');
    btn.onclick=()=>showPage(i);
    pag.appendChild(btn);
  }
}

/* ===== Tombol Simpan / Terapkan ===== */
async function applyAndSave(){
  const ids=parseIds();
  if(!ids.length){ showToast('Tidak ada ID produk yang dimasukkan.','#b36b00'); return; }
  let removed=0;
  for(let i=0;i<localStorage.length;i++){
    const key=localStorage.key(i);
    try{
      const data=JSON.parse(localStorage.getItem(key));
      if(data && data.inputList){
        const lines=data.inputList.split("\n").map(l=>l.trim()).filter(Boolean);
        const filtered=lines.filter(l=>{
          const m=l.match(/product\/\d+\/(\d+)/);
          const id=m?m[1]:'';
          return !ids.includes(id);
        });
        if(filtered.length!==lines.length){
          removed+=lines.length-filtered.length;
          data.inputList=filtered.join("\n");
          localStorage.setItem(key, JSON.stringify(data));
        }
      }
    }catch{}
  }
  saveFilterInput();
  processAndRender();
  showToast(`âœ… Dihapus permanen ${removed} link dari semua data.`, '#008000');
}

/* ===== Event ===== */
document.getElementById('idsInput').addEventListener('input', ()=>{
  saveFilterInput();
  processAndRender(); // ðŸ”¥ Auto-filter saat mengetik
});
document.getElementById('applyBtn').addEventListener('click', applyAndSave);

/* ===== Inisialisasi ===== */
window.addEventListener('load', ()=>{
  document.getElementById('idsInput').value=localStorage.getItem('filter_produk_ids')||'';
  processAndRender();
});
</script>
</body>
</html>