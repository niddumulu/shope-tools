<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Backup & Import Data MadGazan</title>
<style>
  body { 
    font-family: Arial, sans-serif; 
    margin: 15px; 
    max-width: 600px; 
    margin-inline:auto; 
    background-color:#fffef9; 
  }
  h1,h2,h3 { color:#b36b00; text-align:center; }
  h1 { font-size:1.6rem; margin-bottom:5px; }
  .backup-area { 
    padding:12px; 
    background:#fffbe6; 
    border-radius:8px; 
    border:1px solid #ffd42a; 
    text-align:center; 
  }
  .input-buttons { 
    display:flex; 
    gap:8px; 
    margin-top:6px; 
    flex-wrap:wrap; 
    justify-content:center; 
  }
  .input-buttons button, .input-buttons input[type="file"] { 
    flex:1; 
    padding:10px; 
    font-size:0.95rem; 
    cursor:pointer; 
    border:1px solid #ccc; 
    border-radius:6px; 
    background:#f5f5f5; 
  }
  .input-buttons button:hover { background:#eee; }
  #toast {
    position: fixed; bottom: 25px; right: 25px; 
    padding: 12px 20px; border-radius: 8px; 
    box-shadow: 0 2px 10px rgba(0,0,0,0.3); 
    opacity: 0; transform: translateY(20px); 
    transition: opacity 0.4s, transform 0.4s; 
    z-index: 9999; max-width: 320px; white-space: pre-line; 
    line-height:1.3; font-size:0.95rem; color:#fff;
  }
  pre { font-family: monospace; }
</style>
</head>
<body>

<h1>Backup & Import Data</h1>

<div class="backup-area">
  <h3>üîí Import & Lihat Semua Data LocalStorage</h3>
  <div class="input-buttons">
    <input type="file" id="importFile" accept=".json">
    <button onclick="importUniversal()">üì¶ Import Universal</button>
    <button onclick="showAllLocalStorageData()">üìÑ Tampilkan Semua Data</button>
  </div>
  <button style="margin-top:10px; background:#ffd0d0; border-color:#cc0000;" onclick="resetLocalStorage()">‚ùå Hapus Semua Data LocalStorage</button>
</div>

<div class="display-area" style="margin-top:20px; text-align:center;">
  <pre id="localData" style="text-align:left; margin-top:12px; padding:10px; background:#f9f9f9; border:1px solid #ddd; border-radius:6px; max-height:300px; overflow:auto;"></pre>
</div>

<!-- Toast -->
<div id="toast"></div>

<script>
/* ===== Toast Notification ===== */
function showToast(message, type='info') {
  const toast = document.getElementById('toast');
  toast.textContent = message;
  let bgColor = '#333';
  if(type === 'success') bgColor = '#4CAF50';
  if(type === 'error') bgColor = '#f44336';
  if(type === 'warning') bgColor = '#b36b00';
  if(type === 'info') bgColor = '#2196F3';
  toast.style.background = bgColor;
  toast.style.opacity = '1';
  toast.style.transform = 'translateY(0)';
  setTimeout(() => {
    toast.style.opacity = '0';
    toast.style.transform = 'translateY(20px)';
  }, 4000);
}

/* ===== Import Universal ===== */
function importUniversal() {
  const fileInput = document.getElementById('importFile');
  const file = fileInput.files[0];
  if (!file) return showToast('‚ùå Pilih file JSON dulu.', 'error');
  const reader = new FileReader();
  reader.onload = e => {
    try {
      const data = JSON.parse(e.target.result);
      Object.keys(data).forEach(key => localStorage.setItem(key, data[key]));
      showToast('‚úÖ Data berhasil diimport (Universal).', 'success');
      setTimeout(showAllLocalStorageData, 1000);
    } catch (err) {
      showToast('‚ùå File tidak valid: ' + err.message, 'error');
    }
  };
  reader.readAsText(file);
}

/* ===== Reset Semua Data ===== */
function resetLocalStorage() {
  if (confirm('Yakin ingin menghapus semua data localStorage?')) {
    localStorage.clear();
    showToast('‚ö†Ô∏è Semua data LocalStorage telah dihapus.', 'warning');
    document.getElementById('localData').textContent = '';
  }
}

/* ===== Tampilkan Semua Data ===== */
function showAllLocalStorageData() {
  const display = document.getElementById('localData');
  if (localStorage.length === 0) {
    display.textContent = 'üì≠ LocalStorage kosong.';
    showToast('‚ÑπÔ∏è Tidak ada data untuk ditampilkan.', 'info');
    return;
  }
  const data = {};
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    data[key] = localStorage.getItem(key);
  }
  display.textContent = JSON.stringify(data, null, 2);
  showToast('‚úÖ Semua data LocalStorage berhasil ditampilkan.', 'success');
}
</script>

<!-- ===== Fitur Filter Toko ===== -->
<hr style="margin:25px 0;">
<h3 style="text-align:center; color:#b36b00;">üßπ Filter Berdasarkan ID Toko Shopee</h3>

<div style="text-align:center; margin-bottom:12px;">
  <input id="shopInput" type="text" placeholder="Masukkan link atau ID toko Shopee..." 
         style="width:90%; max-width:400px; padding:8px; border:1px solid #ccc; border-radius:6px;">
</div>
<div style="text-align:center;">
  <button onclick="filterByShopId()" 
          style="padding:10px 18px; background:#ffefc2; border:1px solid #d4a017; border-radius:6px; cursor:pointer;">
    üö´ Hapus Semua Data dari Toko Ini
  </button>
</div>

<script>
function filterByShopId() {
  const input = document.getElementById('shopInput').value.trim();
  if (!input) return showToast('‚ö†Ô∏è Masukkan link atau ID toko terlebih dahulu.', 'warning');

  // Ekstrak ID toko dari link Shopee jika ada
  const shopIdMatch = input.match(/shopee\.co\.id\/product\/(\d+)/);
  const shopId = shopIdMatch ? shopIdMatch[1] : input.replace(/\D/g, ''); // hanya ambil angka

  if (!shopId) return showToast('‚ùå Tidak dapat menemukan ID toko yang valid.', 'error');

  let deleted = 0;
  const toDelete = [];

  // Cari data di localStorage yang mengandung ID toko
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    const value = localStorage.getItem(key);
    if (value && value.includes(shopId)) {
      toDelete.push(key);
    }
  }

  // Hapus semua yang cocok
  toDelete.forEach(k => {
    localStorage.removeItem(k);
    deleted++;
  });

  showToast(`üßπ ${deleted} data dari toko ID ${shopId} berhasil dihapus.`, 'success');
  showAllLocalStorageData(); // tampilkan ulang data terbaru setelah dihapus
}
</script>

</body>
</html>