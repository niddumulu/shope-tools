<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Backup & Filter Data MadGazan</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 15px;
    max-width: 600px;
    margin-inline:auto;
    background-color:#fffef9;
  }
  h1,h3 { color:#b36b00; text-align:center; }
  h1 { font-size:1.6rem; margin-bottom:5px; }
  .section {
    padding:12px;
    background:#fffbe6;
    border-radius:8px;
    border:1px solid #ffd42a;
    text-align:center;
    margin-bottom:20px;
  }
  button, input[type="file"], textarea {
    padding:10px;
    font-size:0.95rem;
    border-radius:6px;
    border:1px solid #ccc;
    background:#f5f5f5;
    cursor:pointer;
  }
  button:hover { background:#eee; }
  textarea {
    width:100%;
    height:70px;
    resize:none;
    margin-top:6px;
    font-family:monospace;
  }
  #toast {
    position: fixed; bottom: 25px; right: 25px;
    padding: 12px 20px; border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    opacity: 0; transform: translateY(20px);
    transition: opacity 0.4s, transform 0.4s;
    z-index: 9999; max-width: 320px; white-space: pre-line;
    line-height:1.3; font-size:0.95rem; color:#fff;
  }
  pre {
    font-family: monospace;
    text-align:left;
    margin-top:12px;
    padding:10px;
    background:#f9f9f9;
    border:1px solid #ddd;
    border-radius:6px;
    max-height:300px;
    overflow:auto;
  }
</style>
</head>
<body>

<h1>Backup & Filter Data</h1>

<div class="section">
  <h3>üìÅ Import & Tampilkan Data</h3>
  <input type="file" id="importFile" accept=".json">
  <br><br>
  <button onclick="importUniversal()">Import Universal</button>
  <button onclick="showAllData()">Tampilkan Semua Data</button>
</div>

<div class="section">
  <h3>üßπ Filter / Hapus Berdasarkan ID Toko</h3>
  <p>Masukkan satu atau beberapa ID toko Shopee (pisahkan dengan koma atau baris baru):</p>
  <textarea id="filterIds" placeholder="Contoh: 968553125, 123456789"></textarea>
  <button onclick="filterByStoreIds()">üö´ Filter & Hapus Link Toko</button>
</div>

<pre id="output">üì≠ Belum ada data yang ditampilkan.</pre>

<div id="toast"></div>

<script>
/* ===== Toast Notification ===== */
function showToast(message, type='info') {
  const toast = document.getElementById('toast');
  toast.textContent = message;
  let bgColor = '#333';
  if(type === 'success') bgColor = '#4CAF50';
  if(type === 'error') bgColor = '#f44336';
  if(type === 'warning') bgColor = '#b36b00';
  if(type === 'info') bgColor = '#2196F3';
  toast.style.background = bgColor;
  toast.style.opacity = '1';
  toast.style.transform = 'translateY(0)';
  setTimeout(() => {
    toast.style.opacity = '0';
    toast.style.transform = 'translateY(20px)';
  }, 4000);
}

/* ===== Import Universal ===== */
function importUniversal() {
  const fileInput = document.getElementById('importFile');
  const file = fileInput.files[0];
  if (!file) return showToast('‚ùå Pilih file JSON terlebih dahulu.', 'error');
  const reader = new FileReader();
  reader.onload = e => {
    try {
      const data = JSON.parse(e.target.result);
      Object.keys(data).forEach(key => localStorage.setItem(key, data[key]));
      showToast('‚úÖ Data berhasil diimport.', 'success');
      showAllData();
    } catch (err) {
      showToast('‚ùå File tidak valid: ' + err.message, 'error');
    }
  };
  reader.readAsText(file);
}

/* ===== Tampilkan Semua Data ===== */
function showAllData() {
  const data = {};
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    data[key] = localStorage.getItem(key);
  }
  const out = document.getElementById('output');
  out.textContent = Object.keys(data).length
    ? JSON.stringify(data, null, 2)
    : 'üì≠ LocalStorage kosong.';
  showToast('‚úÖ Semua data ditampilkan.', 'success');
}

/* ===== Auto Backup Sebelum Filter ===== */
function backupBeforeFilter() {
  const data = {};
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    data[key] = localStorage.getItem(key);
  }
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'backup_sebelum_filter.json';
  a.click();
  URL.revokeObjectURL(url);
}

/* ===== Filter Berdasarkan ID Toko ===== */
function filterByStoreIds() {
  const idsInput = document.getElementById('filterIds').value.trim();
  if (!idsInput) return showToast('‚ö†Ô∏è Masukkan minimal satu ID toko.', 'warning');
  
  backupBeforeFilter(); // aman, auto backup
  
  const ids = idsInput.split(/[\s,]+/).filter(Boolean);
  let totalRemoved = 0;
  const newData = {};

  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    let value = localStorage.getItem(key);
    try {
      const parsed = JSON.parse(value);
      if (parsed && parsed.inputList) {
        const lines = parsed.inputList.split('\n').map(l => l.trim()).filter(Boolean);
        const filtered = lines.filter(line => !ids.some(id => line.includes(`product/${id}/`) || line.includes(`product/${id}`)));
        totalRemoved += lines.length - filtered.length;
        if (filtered.length > 0) {
          parsed.inputList = filtered.join('\n');
          newData[key] = JSON.stringify(parsed);
        }
      } else {
        newData[key] = value;
      }
    } catch {
      newData[key] = value;
    }
  }

  localStorage.clear();
  Object.keys(newData).forEach(k => localStorage.setItem(k, newData[k]));

  showAllData();
  showToast(`‚úÖ Filter selesai. ${totalRemoved} link dihapus.`, 'success');
}
</script>

</body>
</html>