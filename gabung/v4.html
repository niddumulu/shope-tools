<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Filter / Hapus Berdasarkan ID Toko Shopee</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; max-width: 900px; margin-inline: auto; }
  h2 { text-align: center; }
  textarea { width: 100%; height: 100px; margin: 10px 0; font-family: monospace; padding: 10px; }
  button { padding: 10px 15px; cursor: pointer; margin: 5px 0; }
  .result { margin-top: 20px; white-space: pre-wrap; background: #f9f9f9; border: 1px solid #ccc; padding: 10px; }
  .pagination { margin: 10px 0; text-align: center; }
  .pagination button { margin: 0 5px; padding: 5px 10px; }
  .count { text-align: center; margin-bottom: 10px; font-size: 0.9em; color: #555; }
</style>
</head>
<body>

<h2>Filter / Hapus Berdasarkan ID Toko Shopee</h2>
<p>Masukkan satu atau beberapa ID toko (pisah koma, spasi, atau baris baru).<br>
Contoh: <code>968553125</code> atau <code>https://shopee.co.id/product/968553125/29726307611</code></p>

<textarea id="idsInput" placeholder="Masukkan ID atau link toko Shopee di sini..."></textarea>
<button onclick="filterToko()">Filter & Hapus Link Toko</button>

<div id="outputArea" class="result"></div>

<script>
let allData = [];
let currentPage = 1;
const perPage = 99;

// ambil semua data dari localStorage (universal)
function loadDataFromLocalStorage() {
  let data = [];
  for (let key in localStorage) {
    try {
      const arr = JSON.parse(localStorage.getItem(key));
      if (Array.isArray(arr)) data = data.concat(arr);
    } catch (e) {}
  }
  return data;
}

// parsing input ID atau link Shopee
function parseIds() {
  const raw = document.getElementById('idsInput').value.trim();
  if (!raw) return [];
  const parts = raw.split(/[\n,; ]+/).map(s => s.trim()).filter(Boolean);
  const ids = [];
  for (const p of parts) {
    const match = p.match(/product\/(\d+)\//);
    if (match) {
      ids.push(match[1]);
      continue;
    }
    const digits = p.replace(/\D/g, '');
    if (digits.length >= 5) ids.push(digits);
  }
  return Array.from(new Set(ids));
}

// tampilkan hasil dengan pagination
function renderPage() {
  const outputArea = document.getElementById('outputArea');
  if (!allData.length) {
    outputArea.innerHTML = '<p><i>Tidak ada data ditemukan.</i></p>';
    return;
  }
  const totalPages = Math.ceil(allData.length / perPage);
  currentPage = Math.min(currentPage, totalPages);
  const start = (currentPage - 1) * perPage;
  const end = start + perPage;
  const pageData = allData.slice(start, end);

  const pagination = `
    <div class="pagination">
      <button ${currentPage === 1 ? 'disabled' : ''} onclick="changePage(-1)">⬅️ Sebelumnya</button>
      <span>Halaman ${currentPage} / ${totalPages}</span>
      <button ${currentPage === totalPages ? 'disabled' : ''} onclick="changePage(1)">➡️ Berikutnya</button>
    </div>
    <div class="count">Menampilkan ${pageData.length} dari total ${allData.length} link</div>
  `;

  const list = pageData.map((item, i) => `${start + i + 1}. ${item.link || item}`).join('\n');
  outputArea.innerHTML = pagination + '<pre>' + list + '</pre>';
}

function changePage(delta) {
  currentPage += delta;
  renderPage();
}

// fungsi utama filter
function filterToko() {
  const ids = parseIds();
  if (!ids.length) {
    alert('Masukkan minimal satu ID atau link toko Shopee!');
    return;
  }

  let data = loadDataFromLocalStorage();
  if (!data.length) {
    alert('Tidak ada data ditemukan di localStorage.');
    return;
  }

  // hapus data yang mengandung ID toko
  const filtered = data.filter(item => {
    const link = (typeof item === 'string') ? item : (item.link || '');
    return !ids.some(id => link.includes(`product/${id}/`));
  });

  // simpan ulang data yang sudah difilter
  localStorage.setItem('filtered_result', JSON.stringify(filtered));

  allData = filtered;
  currentPage = 1;
  renderPage();

  alert(`Selesai! Semua link dengan ID toko [${ids.join(', ')}] telah dihapus.`);
}
</script>

</body>
</html>